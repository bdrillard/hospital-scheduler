<html>
  <head>
    <title>Hospital Scheduler System</title>
    <meta content="">
    <style>
	.calendar {
		font-family: Arial, Helvetica, sans-serif;
	}
	
	.modalDialog {
		position: fixed;
		font-family: Arial, Helvetica, sans-serif;
		top: 0;
		right: 0;
		bottom: 0;
		left: 0;
		background: rgba(0,0,0,0.8);
		z-index: 10000;
		opacity:0;
		-webkit-transition: opacity 400ms ease-in;
		-moz-transition: opacity 400ms ease-in;
		transition: opacity 400ms ease-in;
		pointer-events: none;
	}

	.modalDialog:target {
		opacity:1;
		pointer-events: auto;
	}

	.modalDialog > div {
		width: 400px;
		position: relative;
		margin: 10% auto;
		padding: 5px 20px 13px 20px;
		border-radius: 10px;
		background: #fff;
		background: -moz-linear-gradient(#fff, #999);
		background: -webkit-linear-gradient(#fff, #999);
		background: -o-linear-gradient(#fff, #999);
	}

	.close {
		background: #606061;
		color: #FFFFFF;
		line-height: 25px;
		position: absolute;
		right: -12px;
		text-align: center;
		top: -10px;
		width: 24px;
		text-decoration: none;
		font-weight: bold;
		-webkit-border-radius: 12px;
		-moz-border-radius: 12px;
		border-radius: 12px;
		-moz-box-shadow: 1px 1px 3px #000;
		-webkit-box-shadow: 1px 1px 3px #000;
		box-shadow: 1px 1px 3px #000;
	}

	.close:hover { background: #00d9ff; }
	</style>
	<link rel='stylesheet' href='fullcalendar.css'/>
	<script src='lib/jquery.min.js'></script>
	<script src='lib/moment.min.js'></script>
	<script src='fullcalendar.js'></script>
	<script type="text/javascript" src="jquery.timepicker.js"></script>
	<link rel="stylesheet" type="text/css" href="jquery.timepicker.css" />
	<script type="text/javascript" src="lib/bootstrap-datepicker.js"></script>
	<link rel="stylesheet" type="text/css" href="lib/bootstrap-datepicker.css" />
	<script type="text/javascript" src="lib/site.js"></script>
	<link rel="stylesheet" type="text/css" href="lib/site.css" />
  </head>
  <body>
  <h1 class="calendar">Hospital Scheduler System</h1>
  <h4 class="calendar"><i>An administrative solution for managing physician appointments</i></h4>
	<script>
		$(document).ready(function() {
		    // page is now ready, initialize the calendar...
            // get list of procedures
            $.getJSON(
                'http://54.174.120.2:3000/procedures',
                function(data) {
                    $.each(data, function(key, val) {
                        $('#tb1').append($('<option/>', {
                            value: val.id,
                            text: val.procedure
                        }));
                        $('#tb7').append($('<option/>', {
                            value: val.id,
                            text: val.procedure
                        }));
                    });
                }
            );

            // get list of doctors
            $.getJSON(
                'http://54.174.120.2:3000/doctors',
                function(data) {
                    $.each(data, function(key, val) {
                        $('#tb2').append($('<option/>', {
                            value: val.id,
                            text: val.doctor
                        }));
                        $('#tb8').append($('<option/>', {
                            value: val.id,
                            text: val.doctor
                        }));
                    });
                }
            );
			$('#calendar').fullCalendar({
			
				events: 'http://54.174.120.2:3000/events-summary',	//our test form
			    	
				//USER WANTS TO CREATE AN APPOINTMENT ON THIS DAY
				dayClick: function(date, jsEvent, view) {

					//format the date for the database
					var date = moment().format("YYYY-MM-DD HH:mm:ss");
                    $('#tb5').val(date);
                    $('#tb6').val(date);
					//bring the form to the screen for user to fill out
					location.href = "#openModalCreate";	

				},
				
				//IF USER CLICKS EXISTING APPOINTMENT
				eventClick: function(calEvent, jsEvent, view) {
                    // set defaults to existing event
                    $('#tb7').val(calEvent.procedure_id);
                    $('#tb8').val(calEvent.doctor_id);
                    $('#tb9').val(calEvent.descr);
                    $('#tb10').val(calEvent.patient);
                    $('#tb11').val(calEvent.start._i);
                    $('#tb12').val(calEvent.end._i);
                    $('#tb13').val(calEvent.id);
					location.href = "#openModalUpdate";
				}
				
			});	
		});
		
		
	</script>
	<div id='calendar' class="calendar"></div>

	<a href="#openModalCreate"/>
	<div id="openModalCreate" class="modalDialog">
		<div>
			<a href="#closeCreate" title="Close" class="close" onclick="resetForm()">X
			  <script>
			    //reset anything typed in the form
				function resetForm(){
				  for(var i = 1; i<=6; i++) {
				  document.getElementById("tb" + i).value = "";
				  }
				}
			  </script>
			</a>
			<h2>Schedule Appointment</h2>
			<div id="procedure">Procedure:
			  <select id="tb1">
			    <!-- Dynamically filled -->
              </select>
			</div><br/>
			<div id="doctor">Doctor:
			  <select id="tb2">
                  <!-- Dynamically filled -->
			  </select>
			</div><br/>
			<div id="descr">Description:
			  <input type="text" id="tb3"/>
			</div><br/>
			<div id="patient">Patient:
			  <input type="text" id="tb4"/>
			</div><br/>
			<div id="start">Start:
              <input type="text" id="tb5"/>
			</div><br/>
			<div id="duration">End:
			  <input type="text" id="tb6"/>
			</div><br/>
			<button id="create" onclick="create()">Create</button>
			<script>
			    function create(){
                    var procedure = document.getElementById("tb1").value;
                    var doctor = document.getElementById("tb2").value;
                    var descr = document.getElementById("tb3").value;
                    var patient = document.getElementById("tb4").value;
                    var start = document.getElementById("tb5").value;
                    var end = document.getElementById("tb6").value;
                    
                    $.ajax({
                            url: 'http://54.174.120.2:3000/create-event',
                            type: 'PUT',
                            data: {procedure_id: procedure,
                                   doctor_id: doctor,
                                   descr: descr,
                                   patient: patient,
                                   start: start,
                                   end: end},
                            success: function(result) {
                                $('#calendar').fullCalendar( 'refetchEvents' );
                                $('#calendar').fullCalendar( 'rerenderEvents' );
					            location.href = "#closeCreate";
                            }
                    });
			    }
			</script>
		</div>
	</div>

	<a href="#openModalUpdate"/>
	<div id="openModalUpdate" class="modalDialog">
		<div>
			<a href="#closeUpdate" title="Close" class="close" onclick="resetForm()">X
			  <script>
			    //reset anything typed in the form
				function resetForm(){
				  for(var i = 1; i<=6; i++) {
				  document.getElementById("tb" + i).value = "";
				  }
				}
			  </script>
			</a>
			<h2>Schedule Appointment</h2>
			<div id="procedure">Procedure:
			  <select id="tb7">
			    <!-- Dynamically filled -->
              </select>
			</div><br/>
			<div id="doctor">Doctor:
			  <select id="tb8">
                  <!-- Dynamically filled -->
			  </select>
			</div><br/>
			<div id="descr">Description:
			  <input type="text" id="tb9"/>
			</div><br/>
			<div id="patient">Patient:
			  <input type="text" id="tb10"/>
			</div><br/>
			<div id="start">Start:
              <input type="text" id="tb11"/>
			</div><br/>
			<div id="duration">End:
			  <input type="text" id="tb12"/>
			</div><br/>
            <div id="id" style="visibility: hidden">
                <input type="text" id="tb13"/>
            </div>
			<button id="update" onclick="update()">Update</button>
            <button id="delete" onclick="remove()">Delete</button>
			<script>
			    function update(){
                    var id = document.getElementById("tb13").value;
                    var procedure = document.getElementById("tb7").value;
                    var doctor = document.getElementById("tb8").value;
                    var descr = document.getElementById("tb9").value;
                    var patient = document.getElementById("tb10").value;
                    var start = document.getElementById("tb11").value;
                    var end = document.getElementById("tb12").value;
                    
                    $.ajax({
                            url: 'http://54.174.120.2:3000/' + id + '/update-event',
                            type: 'POST',
                            data: {procedure_id: upProcedure,
                                   doctor_id: upDoctor,
                                   descr: upDescr,
                                   patient: upPatient,
                                   start: upStart,
                                   end: upEnd},
                            success: function(result) {
                                $('#calendar').fullCalendar( 'refetchEvents' );
                                $('#calendar').fullCalendar( 'rerenderEvents' );
					            location.href = "#closeUpdate";
                            }
                    });
			    }

                function remove(){
                    var id = document.getElementById("tb13").value;
                    $.ajax({
                            url: 'http://54.174.120.2:3000/' + id + '/delete-event',
                            type: 'DELETE',
                            success: function(result) {
                                $("#calendar").fullCalendar( 'refetchEvents' );
                                $("#calendar").fullCalendar( 'rerenderEvents' );
					            location.href = "#closeUpdate";
                            }
                    });
                }
			</script>
		</div>
	</div>
</body>
</html>
